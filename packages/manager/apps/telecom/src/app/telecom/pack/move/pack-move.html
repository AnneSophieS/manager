<div class="telecom-pack-move">
    <header>
        <tuc-section-back-link data-tuc-section-back-link-to-state="{{ $ctrlpackName === 'sdsl' ? 'telecom.dashboard' : 'telecom.pack' }}"></tuc-section-back-link>
        <h1 data-translate="pack_move_title"></h1>
    </header>

    <div class="telecom-section-content">

        <div class="text-center" data-ng-if="$ctrl.loading">
            <oui-spinner></oui-spinner>
        </div>

        <!-- BEGIN: end of loading -->
        <div data-ng-if="!$ctrl.loading">
            <div class="alert alert-warning mt-4"
                 role="alert"
                 data-ng-if="$ctrl.operationAlreadyPending">
                <strong data-translate="pack_move_operation_already_pending"></strong>
            </div>
            <div class="alert alert-warning mt-4"
                 role="alert"
                 data-ng-if="!$ctrl.operationAlreadyPending && $ctrl.offer.current.isLegacy">
                <strong data-translate="pack_move_legacy_offer"></strong>
                <a data-translate="pack_move_legacy_offer_upgrade_offer"
                   data-ui-sref="telecom.pack.migration">
                </a>
            </div>

            <tuc-toast-message></tuc-toast-message>

            <!-- BEGIN: Is not legacy offer -->
            <div data-ng-if="!$ctrl.operationAlreadyPending  && !$ctrl.offer.current.isLegacy">

                <!-- BEGIN: Line Information -->
                <div class="widget-presentation">
                    <h2 class="widget-presentation-title" data-translate="pack_move_line_title"></h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="radio">
                                <label for="radioNumber">
                                    <input type="radio"
                                           id="radioNumber"
                                           data-ng-model="$ctrl.method"
                                           data-ng-value="'number'"/>
                                    <span data-translate="pack_move_line_subtitle"></span>
                                </label>
                            </div>
                            <pack-move-eligibility-line-number data-offers-change="$ctrl.computeOffer(OFFERS)"
                                                               data-submited="$ctrl.ongoingTest()"
                                                               data-method="$ctrl.method">
                            </pack-move-eligibility-line-number>
                        </div>

                        <div class="col-md-6">
                            <div class="radio">
                                <label for="radioAddress">
                                    <input type="radio"
                                           id="radioAddress"
                                           data-ng-model="$ctrl.method"
                                           data-ng-value="'address'"/>
                                    <span data-translate="pack_move_address_subtitle"></span>
                                </label>
                            </div>
                            <pack-move-eligibility-address data-offers-change="$ctrl.computeOffer(OFFERS)"
                                                           data-submited="$ctrl.ongoingTest()"
                                                           data-method="$ctrl.method">
                            </pack-move-eligibility-address>
                            <div class="alert alert-warning"
                                 role="alert"
                                 data-ng-if="!$ctrl.testLine.canMove && $ctrl.testLine.performed">
                                <strong data-translate="pack_move_cannot_move"></strong>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END: Line Information -->

                <!-- BEGIN: pack move form -->
                <form name="packMoveForm"
                      data-ng-if="$ctrl.testLine.canMove && $ctrl.testLine.performed"
                      data-ng-submit="$ctrl.openConfirmModal()">

                    <!-- BEGIN: Eligibility -->
                    <div class="widget-presentation">
                        <h2 class="widget-presentation-title" data-translate="pack_move_eligibility_title"></h2>
                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <span class="service-item" data-translate="pack_move_eligibility_subtitle"></span>
                                <div data-ng-repeat="offer in $ctrl.offer.available track by $index">
                                    <pack-move-offer data-offer="offer"
                                                     data-change="$ctrl.offerSelected(OFFER)"
                                                     data-offer-model="$ctrl.offer.selected"></pack-move-offer>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END: Eligibility -->

                    <!-- BEGIN: Keep numbers -->
                    <div class="widget-presentation py-3 move-number-config">
                        <h2 class="widget-presentation-title" data-translate="pack_move_line_keep_number"></h2>
                        <div class="row m-0 p-0">
                            <!-- BEGIN: Current Address -->
                            <pack-move-address-current data-loading="$ctrl.packAdress.loading || $ctrl.slammingCheck"
                                                       data-line-number="{{$ctrl.packAdress.lineNumber}}"
                                                       data-port-line-number="$ctrl.form.currentLandline.portLineNumber"
                                                       data-portability="$ctrl.packAdress.portability && !$ctrl.hasSlamming"
                                                       data-address="$ctrl.packAdress.current">
                            </pack-move-address-current>
                            <!-- END: Current Address -->
                            <!-- BEGIN: New Address -->
                            <pack-move-address-future
                                data-address="$ctrl.offer.selected.address"
                                data-address-loading="$ctrl.packAdress.loading"
                                data-rio="$ctrl.form.futureLandline.rio"
                                data-keep-line-number="$ctrl.form.futureLandline.keepLineNumber"
                                data-can-keep-line-number="$ctrl.canKeepLineNumber()"
                                data-line-number="{{$ctrl.form.futureLandline.lineNumber}}">
                            </pack-move-address-future>
                            <!-- END: New Address -->
                        </div>
                    </div>
                    <!-- END: Keep numbers -->

                    <!-- BEGIN: FT meeting -->
                    <div class="widget-presentation py-3 move-number-config ft-meeting"
                         data-ng-if="$ctrl.offer.selected.meetingSlots">
                        <h2 class="widget-presentation-title" data-translate="pack_move_meeting_slots"></h2>
                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <p data-ng-show="$ctrl.offer.selected.meetingSlots"
                                   data-translate="pack_move_mandatory_field"></p>

                                <div data-ng-show="$ctrl.offer.selected.meetingSlots.canBookFakeMeeting &&
                                    $ctrl.offer.selected.meetingSlots.meetingSlots.length">
                                    <div class="input-group mt-3 col-md-12">
                                        <input type="radio"
                                            id="radioFakeMeeting"
                                            data-ng-model="$ctrl.offer.meetingSlots.fakeMeeting"
                                            data-ng-disabled="!$ctrl.offer.selected.meetingSlots.canBookFakeMeeting"
                                            data-ng-value="true"/>
                                        <label for="radioFakeMeeting"
                                               class="pl-2"
                                               data-translate="pack_move_fake_meeting">
                                        </label>
                                    </div>
                                    <div  class="input-group mt-3 col-md-12">
                                        <input type="radio"
                                            id="radioNoFakeMeeting"
                                            data-ng-model="$ctrl.offer.meetingSlots.fakeMeeting"
                                            data-ng-value="false"/>
                                        <label for="radioNoFakeMeeting"
                                               class="pl-2"
                                               data-translate="pack_move_no_fake_meeting">
                                        </label>
                                    </div>
                                </div>

                                <div class="alert alert-info"
                                     role="alert"
                                     data-ng-if="$ctrl.offer.selected.meetingSlots.canBookFakeMeeting &&
                                                 !$ctrl.offer.selected.meetingSlots.meetingSlots.length"
                                     data-translate="pack_move_no_erdv_info">
                                </div>

                                <div class="mt-5" data-translate="pack_move_contact_name_info"></div>

                                <div class="mt-3">
                                    <label class="control-label required"
                                           for="contactNameId"
                                           data-translate="pack_move_contact_name"></label>
                                    <input id="contactNameId"
                                        class="form-control"
                                        required
                                        pattern=".+"
                                        data-ng-model="$ctrl.offer.selected.contactName"
                                        placeholder="{{'pack_move_contact_name'| translate}}"/>
                                </div>

                                <div class="mt-5 required"
                                     data-ng-show="$ctrl.offer.selected.meetingSlots.meetingSlots.length &&
                                     !$ctrl.offer.meetingSlots.fakeMeeting"
                                     data-translate="pack_move_programmed_meeting_select">
                                </div>

                                <div class="row mt-3">
                                    <div class="col-xs-12 meeting-calendar"
                                        data-ui-calendar="$ctrl.calendarConfig"
                                        data-ng-model="$ctrl.offer.selected.meetingSlots.calendarData"
                                        data-calendar="mainCalendar"
                                        data-ng-hide="$ctrl.offer.selected.meetingSlots.canBookFakeMeeting && $ctrl.offer.meetingSlots.fakeMeeting">
                                    </div>
                                </div>

                                <p class="mt-5"
                                    data-ng-show="$ctrl.offer.selected.meetingSlots.meetingSlots.length &&
                                        !$ctrl.offer.meetingSlots.fakeMeeting">
                                    <span data-translate="pack_move_programmed_meeting"
                                        data-ng-show="$ctrl.offer.meetingSlots.slot"
                                        data-translate-values="$ctrl.offer.meetingSlots.slot.display"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- END: FT meeting -->

                    <div class="mb-5">
                        <button class="btn btn-primary"
                            type="submit"
                            data-ng-class="{
                                'btn-info': $ctrl.moveValidationPending,
                                'btn-warning': $ctrl.moveValidationError && !$ctrl.moveValidationPending,
                                'btn-primary': (!$ctrl.moveValidationPending && !$ctrl.moveValidationError && !$ctrl.moveValidationSuccess) || ($ctrl.moveValidationSuccess && !$ctrl.moveValidationPending)}"
                            data-ng-disabled="!$ctrl.isFormValid() ||
                            $ctrl.moveValidationPending || $ctrl.moveValidationSuccess">
                            <span data-ng-show="!$ctrl.moveValidationPending && !$ctrl.moveValidationError &&
                            !$ctrl.moveValidationSuccess" data-translate="pack_move_validate"></span>
                            <span data-ng-show="$ctrl.moveValidationPending">
                                <span data-translate="pack_move_pending_validation"></span>
                                <span class="fa fa-spin fa-spinner ml-2" aria-hidden="true"></span>
                            </span>
                            <span data-ng-show="$ctrl.moveValidationError && !$ctrl.moveValidationPending">
                                <span data-translate="pack_move_error_validation"></span>
                                <span class="ovh-font ovh-font-warning ml-2" aria-hidden="true"></span>
                            </span>
                            <span data-ng-show="$ctrl.moveValidationSuccess && !$ctrl.moveValidationPending">
                                <span data-translate="pack_move_success_validation"></span>
                                <span class="ovh-font ovh-font-check ml-2" aria-hidden="true"></span>
                            </span>
                        </button>
                    </div>
                </form>

                <!-- BEGIN: pack move form -->
            </div>
            <!-- END: Is not legacy offer -->
        </div>
        <!-- END: end of loading -->
    </div>
</div>
